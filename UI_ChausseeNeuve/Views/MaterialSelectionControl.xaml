<?xml version="1.0" encoding="utf-8"?>
<UserControl x:Class="UI_ChausseeNeuve.Views.MaterialSelectionControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:local="clr-namespace:UI_ChausseeNeuve.Views"
             xmlns:viewModels="clr-namespace:UI_ChausseeNeuve.ViewModels"
             mc:Ignorable="d"
             d:DesignWidth="1200" d:DesignHeight="500"
             FontFamily="Segoe UI"
             Background="{StaticResource PrimaryBg}">

    <UserControl.Resources>
        <!-- Basic brushes (ASCII only) -->
        <SolidColorBrush x:Key="GridSeparatorBrush" Color="#50555B"/>
        <SolidColorBrush x:Key="TableBgLight" Color="#1F2125"/>
        <SolidColorBrush x:Key="HeaderBgLight" Color="#2B2F34"/>
        <SolidColorBrush x:Key="RowBgLight" Color="#2A2D31"/>
        <SolidColorBrush x:Key="RowAltBgLight" Color="#262A2F"/>
        <SolidColorBrush x:Key="RowHoverLight" Color="#333940"/>
        <SolidColorBrush x:Key="RowSelectedLight" Color="#3E4D5A"/>
        <SolidColorBrush x:Key="GridLineLight" Color="#3F4550"/>
        <SolidColorBrush x:Key="TextPrimaryDark" Color="#EDEFF2"/>
        <SolidColorBrush x:Key="MbHeaderBg" Color="#2C3E50"/>
        <SolidColorBrush x:Key="MtlhHeaderBg" Color="#E8F5E8"/>
        <SolidColorBrush x:Key="MtlhTextColor" Color="#2E7D32"/>
        <SolidColorBrush x:Key="BetonHeaderBg" Color="#ECF0F1"/>
        <SolidColorBrush x:Key="BetonTextColor" Color="#34495E"/>
        <SolidColorBrush x:Key="SolHeaderBg" Color="#FDF2E9"/>
        <SolidColorBrush x:Key="SolTextColor" Color="#8B4513"/>

        <!-- ListBox -->
        <Style x:Key="ModernListBoxStyle" TargetType="ListBox">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryDark}"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>

        <!-- ListView -->
        <Style x:Key="ModernListViewStyle" TargetType="ListView">
            <Setter Property="Background" Value="{StaticResource TableBgLight}"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Auto"/>
            <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto"/>
        </Style>

        <!-- Headers -->
        <Style x:Key="ModernHeaderStyle" TargetType="GridViewColumnHeader">
            <Setter Property="Background" Value="{StaticResource HeaderBgLight}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="6,4"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="BorderBrush" Value="{StaticResource GridLineLight}"/>
            <Setter Property="BorderThickness" Value="0,0,1,1"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="GridViewColumnHeader">
                        <Border Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="2,2,0,0">
                            <Grid>
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" Margin="{TemplateBinding Padding}"/>
                                <Rectangle Fill="{StaticResource GridSeparatorBrush}" Width="1" HorizontalAlignment="Right" Opacity="0.7"/>
                            </Grid>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Rows -->
        <Style x:Key="ModernRowStyle" TargetType="ListViewItem">
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryDark}"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Background" Value="{StaticResource RowBgLight}"/>
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="BorderBrush" Value="{StaticResource GridLineLight}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="Padding" Value="3,6"/>
            <Setter Property="MinHeight" Value="30"/>
            <Style.Triggers>
                <Trigger Property="ItemsControl.AlternationIndex" Value="1">
                    <Setter Property="Background" Value="{StaticResource RowAltBgLight}"/>
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{StaticResource RowSelectedLight}"/>
                    <Setter Property="BorderBrush" Value="{StaticResource GridSeparatorBrush}"/>
                    <Setter Property="FontWeight" Value="SemiBold"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource RowHoverLight}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Control buttons -->
        <Style x:Key="ModernControlButton" TargetType="Button">
            <Setter Property="Width" Value="28"/>
            <Setter Property="Height" Value="28"/>
            <Setter Property="Margin" Value="2"/>
            <Setter Property="Background" Value="#34495E"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#2C3E50"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#4A90E2"/>
                                <Setter Property="BorderBrush" Value="#357ABD"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#2980B9"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Section header -->
        <Style x:Key="SectionHeaderStyle" TargetType="Border">
            <Setter Property="Padding" Value="20,12"/>
            <Setter Property="Margin" Value="0,0,0,15"/>
            <Setter Property="CornerRadius" Value="8,8,0,0"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="Black" Direction="270" ShadowDepth="2" BlurRadius="8" Opacity="0.3"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Table container -->
        <Style x:Key="TableContainerStyle" TargetType="Border">
            <Setter Property="CornerRadius" Value="0,0,8,8"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Margin" Value="0"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect Color="Black" Direction="270" ShadowDepth="3" BlurRadius="10" Opacity="0.2"/>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Converters -->
        <local:StatutCellBgConverter x:Key="StatutCellBgConverter"/>
        <local:CategoryToVisibilityConverter x:Key="CategoryToVisibility"/>

        <!-- Simple list templates -->
        <DataTemplate DataType="{x:Type viewModels:MateriauxBeninViewModel}">
            <ListBox Style="{StaticResource ModernListBoxStyle}" ItemsSource="{Binding AvailableMaterials}" SelectedItem="{Binding SelectedMaterial, Mode=TwoWay}" DisplayMemberPath="Name" SelectionChanged="MaterialSelectionChanged"/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type viewModels:CatalogueSenegalaisViewModel}">
            <ListBox Style="{StaticResource ModernListBoxStyle}" Background="#2D2D30" ItemsSource="{Binding AvailableMaterials}" SelectedItem="{Binding SelectedMaterial, Mode=TwoWay}" DisplayMemberPath="Name" SelectionChanged="MaterialSelectionChanged"/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type viewModels:CatalogueFrancaisViewModel}">
            <ListBox Style="{StaticResource ModernListBoxStyle}" ItemsSource="{Binding AvailableMaterials}" SelectedItem="{Binding SelectedMaterial, Mode=TwoWay}" DisplayMemberPath="Name" SelectionChanged="MaterialSelectionChanged"/>
        </DataTemplate>
        <DataTemplate DataType="{x:Type viewModels:MateriauxUserViewModel}">
            <ListBox Style="{StaticResource ModernListBoxStyle}" Background="#120D0D" ItemsSource="{Binding AvailableMaterials}" SelectedItem="{Binding SelectedMaterial, Mode=TwoWay}" DisplayMemberPath="Name" SelectionChanged="MaterialSelectionChanged"/>
        </DataTemplate>

        <!-- NFP98 list -->
        <DataTemplate DataType="{x:Type viewModels:NFP98ViewModel}">
            <ListView Style="{StaticResource ModernListViewStyle}" ItemsSource="{Binding AvailableMaterials}" SelectedItem="{Binding SelectedMaterial, Mode=TwoWay}" Margin="8">
                <ListView.View>
                    <GridView>
                        <GridView.ColumnHeaderContainerStyle>
                            <Style TargetType="GridViewColumnHeader" BasedOn="{StaticResource ModernHeaderStyle}"/>
                        </GridView.ColumnHeaderContainerStyle>
                        <GridViewColumn Header="Nom" DisplayMemberBinding="{Binding Name}" Width="140"/>
                        <GridViewColumn Header="Famille" DisplayMemberBinding="{Binding MaterialFamily}" Width="100"/>
                        <GridViewColumn Header="Categorie" DisplayMemberBinding="{Binding Category}" Width="80"/>
                        <GridViewColumn Header="Module E (MPa)" DisplayMemberBinding="{Binding ComputedModulus, StringFormat=N0, TargetNullValue=/}" Width="90" />
                        <GridViewColumn Header="v" DisplayMemberBinding="{Binding PoissonRatio, StringFormat=0.##, TargetNullValue=/}" Width="50" />
                        <GridViewColumn Header="Ep. min (m)" DisplayMemberBinding="{Binding MinThickness_m, StringFormat=0.###, TargetNullValue=/}" Width="70" />
                        <GridViewColumn Header="Ep. max (m)" DisplayMemberBinding="{Binding MaxThickness_m, StringFormat=0.###, TargetNullValue=/}" Width="70" />
                        <GridViewColumn Header="Statut" DisplayMemberBinding="{Binding Statut}" Width="70" />
                        <GridViewColumn Header="Sigma6 (MPa)" DisplayMemberBinding="{Binding Sigma6, StringFormat=0.##, TargetNullValue=/}" Width="80" />
                        <GridViewColumn Header="-1/b" DisplayMemberBinding="{Binding InverseB, StringFormat=0.#, TargetNullValue=/}" Width="60" />
                        <GridViewColumn Header="Sh (m)" DisplayMemberBinding="{Binding Sh, StringFormat=0.###, TargetNullValue=/}" Width="70" />
                        <GridViewColumn Header="Kc" DisplayMemberBinding="{Binding Kc, StringFormat=0.#, TargetNullValue=/}" Width="50" />
                        <GridViewColumn Header="Kd" DisplayMemberBinding="{Binding Kd, StringFormat=0.#, TargetNullValue=/}" Width="50" />
                        <GridViewColumn Header="Source" DisplayMemberBinding="{Binding Source}" Width="120" />
                        <GridViewColumn Header="Description" DisplayMemberBinding="{Binding Description}" Width="180" />
                    </GridView>
                </ListView.View>
            </ListView>
        </DataTemplate>
    </UserControl.Resources>

    <Grid>
        <!-- Info message -->
        <Border Background="#2C3E50" CornerRadius="10" Padding="30,20" HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="{Binding SelectedCategory, Converter={StaticResource CategoryToVisibility}, ConverterParameter=NONE}">
            <StackPanel>
                <TextBlock Text="Selection de materiaux" FontSize="18" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                <TextBlock Text="Veuillez selectionner une categorie pour afficher les materiaux disponibles" FontStyle="Italic" FontSize="14" Foreground="#BDC3C7" HorizontalAlignment="Center" TextWrapping="Wrap" TextAlignment="Center"/>
            </StackPanel>
        </Border>

        <!-- MB section -->
        <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto" Visibility="{Binding SelectedCategory, Converter={StaticResource CategoryToVisibility}, ConverterParameter=MB}">
            <StackPanel>
                <Border Style="{StaticResource SectionHeaderStyle}" Background="{StaticResource MbHeaderBg}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <TextBlock Grid.Row="0" Text="Materiaux Bitumineux (MB)" FontSize="18" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center" Margin="0,0,0,12"/>
                        <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Center">
                            <!-- Temperature -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,30,0" VerticalAlignment="Center">
                                <TextBlock Text="Teq =" FontSize="14" FontWeight="SemiBold" Foreground="White" Margin="0,0,8,0"/>
                                <Button Style="{StaticResource ModernControlButton}" Content="-" Click="OnTemperatureDown"/>
                                <Border Background="#34495E" Padding="10,5" Margin="4,0" CornerRadius="4" VerticalAlignment="Center">
                                    <TextBlock FontSize="14" FontWeight="Bold" Foreground="White">
                                        <Run Text="{Binding CurrentMaterialViewModel.SelectedTemperature}"/>
                                        <Run Text=" C" Foreground="#BDC3C7"/>
                                    </TextBlock>
                                </Border>
                                <Button Style="{StaticResource ModernControlButton}" Content="+" Click="OnTemperatureUp"/>
                            </StackPanel>
                            <!-- Frequence -->
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <TextBlock Text="Fr =" FontSize="14" FontWeight="SemiBold" Foreground="White" Margin="0,0,8,0"/>
                                <Button Style="{StaticResource ModernControlButton}" Content="-" Click="OnFrequenceDown"/>
                                <Border Background="#34495E" Padding="10,5" Margin="4,0" CornerRadius="4" VerticalAlignment="Center">
                                    <TextBlock FontSize="14" FontWeight="Bold" Foreground="White">
                                        <Run Text="{Binding CurrentMaterialViewModel.SelectedFrequence}"/>
                                        <Run Text=" Hz" Foreground="#BDC3C7"/>
                                    </TextBlock>
                                </Border>
                                <Button Style="{StaticResource ModernControlButton}" Content="+" Click="OnFrequenceUp"/>
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </Border>

                <Border Style="{StaticResource TableContainerStyle}" Background="{StaticResource TableBgLight}" Margin="0,0,0,25">
                    <ListView x:Name="BitumeListView" Style="{StaticResource ModernListViewStyle}" ItemsSource="{Binding CurrentMaterialViewModel.AvailableMaterials}" SelectedItem="{Binding CurrentMaterialViewModel.SelectedMaterial, Mode=TwoWay}" SelectionChanged="MaterialSelectionChanged" MinWidth="1200" MinHeight="400" AlternationCount="2" local:GridViewVerticalGridLines.IsEnabled="True" ItemContainerStyle="{StaticResource ModernRowStyle}">
                        <ListView.View>
                            <GridView>
                                <GridView.ColumnHeaderContainerStyle>
                                    <Style TargetType="GridViewColumnHeader" BasedOn="{StaticResource ModernHeaderStyle}"/>
                                </GridView.ColumnHeaderContainerStyle>
                                <GridViewColumn Header="Statut" Width="80" DisplayMemberBinding="{Binding Statut}"/>
                                <GridViewColumn Header="Nom" Width="140" DisplayMemberBinding="{Binding Name}"/>
                                <GridViewColumn Header="E (MPa)" Width="90" DisplayMemberBinding="{Binding ComputedModulus, StringFormat=N0, TargetNullValue=/}"/>
                                <GridViewColumn Header="v" Width="50" DisplayMemberBinding="{Binding PoissonRatio, StringFormat=0.##, TargetNullValue=/}"/>
                                <GridViewColumn Header="E(10C)" Width="90" DisplayMemberBinding="{Binding Epsi0_10C, StringFormat=N0, TargetNullValue=/}"/>
                                <GridViewColumn Header="-1/b" Width="60" DisplayMemberBinding="{Binding InverseB, StringFormat=0.#, TargetNullValue=/}"/>
                                <GridViewColumn Header="SN" Width="60" DisplayMemberBinding="{Binding SN, StringFormat=0.##, TargetNullValue=/}"/>
                                <GridViewColumn Header="Sh" Width="60">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="4" Background="Transparent" MouseLeftButtonDown="OnShCellDoubleClick" Cursor="Hand">
                                                <TextBlock Text="{Binding ShDisplay}" TextAlignment="Center" Foreground="#E67E22"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="Kc" Width="60" DisplayMemberBinding="{Binding Kc, StringFormat=0.#, TargetNullValue=/}"/>
                                <GridViewColumn Header="E(-10C)" Width="90" DisplayMemberBinding="{Binding EvsTemperature[-10], StringFormat=N0, TargetNullValue=/}"/>
                                <GridViewColumn Header="E(0C)" Width="90" DisplayMemberBinding="{Binding EvsTemperature[0], StringFormat=N0, TargetNullValue=/}"/>
                                <GridViewColumn Header="E(20C)" Width="90" DisplayMemberBinding="{Binding EvsTemperature[20], StringFormat=N0, TargetNullValue=/}"/>
                                <GridViewColumn Header="E(30C)" Width="90" DisplayMemberBinding="{Binding EvsTemperature[30], StringFormat=N0, TargetNullValue=/}"/>
                                <GridViewColumn Header="E(40C)" Width="90" DisplayMemberBinding="{Binding EvsTemperature[40], StringFormat=N0, TargetNullValue=/}"/>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!-- MTLH section -->
        <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto" Visibility="{Binding SelectedCategory, Converter={StaticResource CategoryToVisibility}, ConverterParameter=MTLH}">
            <StackPanel>
                <Border Style="{StaticResource SectionHeaderStyle}" Background="{StaticResource MtlhHeaderBg}">
                    <TextBlock Text="Materiaux Traites (MTLH)" FontSize="18" FontWeight="Bold" Foreground="{StaticResource MtlhTextColor}" HorizontalAlignment="Center"/>
                </Border>
                <Border Style="{StaticResource TableContainerStyle}" Background="{StaticResource TableBgLight}" Margin="0,0,0,25">
                    <ListView x:Name="MtlhListView" Style="{StaticResource ModernListViewStyle}" ItemsSource="{Binding CurrentMaterialViewModel.AvailableMaterials}" SelectedItem="{Binding CurrentMaterialViewModel.SelectedMaterial, Mode=TwoWay}" SelectionChanged="MaterialSelectionChanged" MinWidth="900" MinHeight="400" AlternationCount="2" local:GridViewVerticalGridLines.IsEnabled="True" ItemContainerStyle="{StaticResource ModernRowStyle}">
                        <ListView.View>
                            <GridView>
                                <GridView.ColumnHeaderContainerStyle>
                                    <Style TargetType="GridViewColumnHeader" BasedOn="{StaticResource ModernHeaderStyle}"/>
                                </GridView.ColumnHeaderContainerStyle>
                                <GridViewColumn Header="Statut" Width="70" DisplayMemberBinding="{Binding Statut}"/>
                                <GridViewColumn Header="Nom" Width="120" DisplayMemberBinding="{Binding Name}"/>
                                <GridViewColumn Header="E (MPa)" Width="80" DisplayMemberBinding="{Binding Modulus_MPa, StringFormat=N0, TargetNullValue=/}"/>
                                <GridViewColumn Header="v" Width="50" DisplayMemberBinding="{Binding PoissonRatio, StringFormat=0.##, TargetNullValue=/}"/>
                                <GridViewColumn Header="s6 (MPa)" Width="80" DisplayMemberBinding="{Binding Sigma6, StringFormat=0.##, TargetNullValue=/}"/>
                                <GridViewColumn Header="-1/b" Width="50" DisplayMemberBinding="{Binding InverseB, StringFormat=0.#, TargetNullValue=/}"/>
                                <GridViewColumn Header="SN" Width="50" DisplayMemberBinding="{Binding SN, StringFormat=0.##, TargetNullValue=/}"/>
                                <GridViewColumn Header="Sh (m)" Width="70">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="4" Background="Transparent" MouseLeftButtonDown="OnShCellDoubleClick" Cursor="Hand">
                                                <TextBlock Text="{Binding Sh, StringFormat=0.###, TargetNullValue=/}" TextAlignment="Center" Foreground="#E67E22"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="Kc" Width="60" DisplayMemberBinding="{Binding Kc, StringFormat=0.#, TargetNullValue=/}"/>
                                <GridViewColumn Header="Kd" Width="60" DisplayMemberBinding="{Binding Kd, StringFormat=0.#, TargetNullValue=/}"/>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!-- Beton section -->
        <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto" Visibility="{Binding SelectedCategory, Converter={StaticResource CategoryToVisibility}, ConverterParameter=Beton}">
            <StackPanel>
                <Border Style="{StaticResource SectionHeaderStyle}" Background="{StaticResource BetonHeaderBg}">
                    <TextBlock Text="Materiaux Beton" FontSize="18" FontWeight="Bold" Foreground="{StaticResource BetonTextColor}" HorizontalAlignment="Center"/>
                </Border>
                <Border Style="{StaticResource TableContainerStyle}" Background="{StaticResource TableBgLight}" Margin="0,0,0,25">
                    <ListView x:Name="BetonListView" Style="{StaticResource ModernListViewStyle}" ItemsSource="{Binding CurrentMaterialViewModel.AvailableMaterials}" SelectedItem="{Binding CurrentMaterialViewModel.SelectedMaterial, Mode=TwoWay}" SelectionChanged="MaterialSelectionChanged" MinWidth="900" MinHeight="400" AlternationCount="2" local:GridViewVerticalGridLines.IsEnabled="True" ItemContainerStyle="{StaticResource ModernRowStyle}">
                        <ListView.View>
                            <GridView>
                                <GridView.ColumnHeaderContainerStyle>
                                    <Style TargetType="GridViewColumnHeader" BasedOn="{StaticResource ModernHeaderStyle}"/>
                                </GridView.ColumnHeaderContainerStyle>
                                <GridViewColumn Header="Statut" Width="80" DisplayMemberBinding="{Binding Statut}"/>
                                <GridViewColumn Header="Nom" Width="140" DisplayMemberBinding="{Binding Name}"/>
                                <GridViewColumn Header="E (MPa)" Width="100" DisplayMemberBinding="{Binding ComputedModulus, StringFormat=N0, TargetNullValue=/}"/>
                                <GridViewColumn Header="v" Width="60" DisplayMemberBinding="{Binding PoissonRatio, StringFormat=0.##, TargetNullValue=/}"/>
                                <GridViewColumn Header="Sigma6 (MPa)" Width="100" DisplayMemberBinding="{Binding Sigma6, StringFormat=0.##, TargetNullValue=/}"/>
                                <GridViewColumn Header="-1/b" Width="60" DisplayMemberBinding="{Binding InverseB, StringFormat=0.#, TargetNullValue=/}"/>
                                <GridViewColumn Header="SN" Width="60" DisplayMemberBinding="{Binding SN, StringFormat=0.##, TargetNullValue=/}"/>
                                <GridViewColumn Header="Kc" Width="60" DisplayMemberBinding="{Binding Kc, StringFormat=0.#, TargetNullValue=/}"/>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!-- Sol & GNT section -->
        <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto" Visibility="{Binding SelectedCategory, Converter={StaticResource CategoryToVisibility}, ConverterParameter=Sol_GNT}">
            <StackPanel>
                <Border Style="{StaticResource SectionHeaderStyle}" Background="{StaticResource SolHeaderBg}">
                    <TextBlock Text="Sol et GNT" FontSize="18" FontWeight="Bold" Foreground="{StaticResource SolTextColor}" HorizontalAlignment="Center"/>
                </Border>
                <Border Style="{StaticResource TableContainerStyle}" Background="{StaticResource TableBgLight}" Margin="0,0,0,25">
                    <ListView x:Name="SolGntListView" Style="{StaticResource ModernListViewStyle}" ItemsSource="{Binding CurrentMaterialViewModel.AvailableMaterials}" SelectedItem="{Binding CurrentMaterialViewModel.SelectedMaterial, Mode=TwoWay}" SelectionChanged="MaterialSelectionChanged" MinWidth="1000" MinHeight="400" AlternationCount="2" local:GridViewVerticalGridLines.IsEnabled="True" ItemContainerStyle="{StaticResource ModernRowStyle}">
                        <ListView.View>
                            <GridView>
                                <GridView.ColumnHeaderContainerStyle>
                                    <Style TargetType="GridViewColumnHeader" BasedOn="{StaticResource ModernHeaderStyle}"/>
                                </GridView.ColumnHeaderContainerStyle>
                                <GridViewColumn Header="Statut" Width="70" DisplayMemberBinding="{Binding Statut}"/>
                                <GridViewColumn Header="Nom" Width="120" DisplayMemberBinding="{Binding Name}"/>
                                <GridViewColumn Header="E (MPa)" Width="80" DisplayMemberBinding="{Binding ComputedModulus, StringFormat=N0, TargetNullValue=/}"/>
                                <GridViewColumn Header="Sigma6 (MPa)" Width="80" DisplayMemberBinding="{Binding Sigma6, StringFormat=0.##, TargetNullValue=/}"/>
                                <GridViewColumn Header="A faible trafic" Width="130" DisplayMemberBinding="{Binding AdditionalProperties[A_faible], StringFormat=0.###, TargetNullValue=/}"/>
                                <GridViewColumn Header="A fort trafic" Width="130" DisplayMemberBinding="{Binding AdditionalProperties[A_fort], StringFormat=0.###, TargetNullValue=/}"/>
                                <GridViewColumn Header="Pente b" Width="100" DisplayMemberBinding="{Binding AdditionalProperties[pente_b], StringFormat=0.###, TargetNullValue=/}"/>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </Border>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
