<UserControl
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:local="clr-namespace:UI_ChausseeNeuve.Views"
    xmlns:viewModels="clr-namespace:UI_ChausseeNeuve.ViewModels"
    x:Class="UI_ChausseeNeuve.Views.MaterialSelectionControl"
    mc:Ignorable="d"
    d:DesignHeight="400"
    d:DesignWidth="900"
    FontFamily="Segoe UI"
    xml:lang="fr-FR"
    Background="{StaticResource PrimaryBg}">

    <UserControl.Resources>
        <!-- Palette locale sombre (scope: ce controle uniquement) -->
        <SolidColorBrush x:Key="GridSeparatorBrush" Color="#50555B"/>
        <SolidColorBrush x:Key="TableBgLight" Color="#1F2125"/>
        <SolidColorBrush x:Key="HeaderBgLight" Color="#2B2F34"/>
        <SolidColorBrush x:Key="RowBgLight" Color="#2A2D31"/>
        <SolidColorBrush x:Key="RowAltBgLight" Color="#262A2F"/>
        <SolidColorBrush x:Key="RowHoverLight" Color="#333940"/>
        <SolidColorBrush x:Key="RowSelectedLight" Color="#3E4D5A"/>
        <SolidColorBrush x:Key="GridLineLight" Color="#3F4550"/>
        <SolidColorBrush x:Key="TextPrimaryDark" Color="#EDEFF2"/>

        <!-- Styles de base SPECIFIQUES a ce controle (ne pas impacter le reste de l'app) -->
        <Style x:Key="AlizeListViewStyle" TargetType="ListView">
            <Setter Property="Background" Value="{StaticResource TableBgLight}"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="TextOptions.TextFormattingMode" Value="Display"/>
            <Setter Property="TextOptions.TextRenderingMode" Value="ClearType"/>
            <Setter Property="UseLayoutRounding" Value="True"/>
        </Style>

        <!-- En-tete style sombre -->
        <Style x:Key="AlizeHeaderStyle" TargetType="GridViewColumnHeader">
            <Setter Property="Background" Value="{StaticResource HeaderBgLight}"/>
            <Setter Property="Foreground" Value="#FFFFFF"/>
            <Setter Property="Padding" Value="6,4"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="BorderBrush" Value="{StaticResource GridLineLight}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="GridViewColumnHeader">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}">
                            <Grid>
                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                <!-- séparateur vertical à droite -->
                                <Rectangle Fill="{StaticResource GridSeparatorBrush}" Width="1" HorizontalAlignment="Right"/>
                            </Grid>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Lignes: zebra sombre -->
        <Style x:Key="AlizeListViewItemStyle" TargetType="ListViewItem">
            <Setter Property="Foreground" Value="{StaticResource TextPrimaryDark}"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="Background" Value="{StaticResource RowBgLight}"/>
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="BorderBrush" Value="{StaticResource GridLineLight}"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="Padding" Value="4,6"/>
            <Style.Triggers>
                <Trigger Property="ItemsControl.AlternationIndex" Value="1">
                    <Setter Property="Background" Value="{StaticResource RowAltBgLight}"/>
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="{StaticResource RowSelectedLight}"/>
                    <Setter Property="BorderBrush" Value="{StaticResource GridSeparatorBrush}"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="{StaticResource RowHoverLight}"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Redefinition locale des Styles utilises par ce fichier uniquement -->
        <Style x:Key="MaterialListViewStyle" TargetType="ListView" BasedOn="{StaticResource AlizeListViewStyle}"/>
        <Style x:Key="ColumnHeaderFlatBlack" TargetType="GridViewColumnHeader" BasedOn="{StaticResource AlizeHeaderStyle}"/>
        <Style x:Key="MaterialListViewItemStyle" TargetType="ListViewItem" BasedOn="{StaticResource AlizeListViewItemStyle}"/>

        <!-- Petits boutons +/- -->
        <Style x:Key="SmallRoundedButton" TargetType="Button" BasedOn="{StaticResource RoundedArrowButtonStyle}">
            <Setter Property="Width" Value="24"/>
            <Setter Property="Height" Value="24"/>
            <Setter Property="Margin" Value="0,0,3,0"/>
            <Setter Property="BorderThickness" Value="1"/>
        </Style>

        <!-- Converters -->
        <local:StatutCellBgConverter x:Key="StatutCellBgConverter"/>
        <local:CategoryToVisibilityConverter x:Key="CategoryToVisibility"/>

        <!-- DataTemplates pour listes simples -->
        <DataTemplate DataType="{x:Type viewModels:MateriauxBeninViewModel}">
            <Grid>
                <ListBox Style="{StaticResource ModernListBoxStyle}"
                         ItemsSource="{Binding AvailableMaterials}"
                         SelectedItem="{Binding SelectedMaterial, Mode=TwoWay}"
                         DisplayMemberPath="Name"
                         SelectionChanged="MaterialSelectionChanged"
                         Background="Transparent"
                         BorderThickness="0"
                         FontSize="12"/>
            </Grid>
        </DataTemplate>

        <DataTemplate DataType="{x:Type viewModels:CatalogueSenegalaisViewModel}">
            <Grid>
                <ListBox Style="{StaticResource ModernListBoxStyle}"
                         ItemsSource="{Binding AvailableMaterials}"
                         SelectedItem="{Binding SelectedMaterial, Mode=TwoWay}"
                         DisplayMemberPath="Name"
                         SelectionChanged="MaterialSelectionChanged"
                         Background="#FF2D2D30"
                         BorderThickness="0"
                         FontSize="12"/>
            </Grid>
        </DataTemplate>

        <DataTemplate DataType="{x:Type viewModels:CatalogueFrancaisViewModel}">
            <Grid>
                <ListBox Style="{StaticResource ModernListBoxStyle}"
                         ItemsSource="{Binding AvailableMaterials}"
                         SelectedItem="{Binding SelectedMaterial, Mode=TwoWay}"
                         DisplayMemberPath="Name"
                         SelectionChanged="MaterialSelectionChanged"
                         Background="Transparent"
                         BorderThickness="0"
                         FontSize="12"/>
            </Grid>
        </DataTemplate>

        <!-- Tableau NFP98 en lecture simple -->
        <DataTemplate DataType="{x:Type viewModels:NFP98ViewModel}">
            <Grid>
                <ListView Style="{StaticResource MaterialListViewStyle}"
                          ItemsSource="{Binding Path=AvailableMaterials}"
                          SelectedItem="{Binding Path=SelectedMaterial, Mode=TwoWay}"
                          Margin="8">
                    <ListView.View>
                        <GridView>
                            <GridView.ColumnHeaderContainerStyle>
                                <Style TargetType="GridViewColumnHeader" BasedOn="{StaticResource ColumnHeaderFlatBlack}"/>
                            </GridView.ColumnHeaderContainerStyle>
                            <GridViewColumn Header="Nom" DisplayMemberBinding="{Binding Name}" Width="140"/>
                            <GridViewColumn Header="Famille" DisplayMemberBinding="{Binding MaterialFamily}" Width="100"/>
                            <GridViewColumn Header="Catégorie" DisplayMemberBinding="{Binding Category}" Width="80"/>
                            <GridViewColumn Header="Module E (MPa)" DisplayMemberBinding="{Binding ComputedModulus, StringFormat=0.###, TargetNullValue=/}" Width="90" />
                            <GridViewColumn Header="ν" DisplayMemberBinding="{Binding PoissonRatio, StringFormat=0.###, TargetNullValue=/}" Width="50" />
                            <GridViewColumn Header="Ép. min (m)" DisplayMemberBinding="{Binding MinThickness_m, StringFormat=0.###, TargetNullValue=/}" Width="70" />
                            <GridViewColumn Header="Ép. max (m)" DisplayMemberBinding="{Binding MaxThickness_m, StringFormat=0.###, TargetNullValue=/}" Width="70" />
                            <GridViewColumn Header="Statut" DisplayMemberBinding="{Binding Statut}" Width="70" />
                            <GridViewColumn Header="Sigma6 (MPa)" DisplayMemberBinding="{Binding Sigma6, StringFormat=0.###, TargetNullValue=/}" Width="80" />
                            <GridViewColumn Header="-1/b" DisplayMemberBinding="{Binding InverseB, StringFormat=0.###, TargetNullValue=/}" Width="60" />
                            <GridViewColumn Header="Sl" DisplayMemberBinding="{Binding Sl, StringFormat=0.###, TargetNullValue=/}" Width="50" />
                            <GridViewColumn Header="Sh (m)" DisplayMemberBinding="{Binding Sh, StringFormat=0.###, TargetNullValue=/}" Width="60" />
                            <GridViewColumn Header="Kc" DisplayMemberBinding="{Binding Kc, StringFormat=0.###, TargetNullValue=/}" Width="50" />
                            <GridViewColumn Header="Kd" DisplayMemberBinding="{Binding Kd, StringFormat=0.###, TargetNullValue=/}" Width="50" />
                            <GridViewColumn Header="Source" DisplayMemberBinding="{Binding Source}" Width="120" />
                            <GridViewColumn Header="Description" DisplayMemberBinding="{Binding Description}" Width="180" />
                        </GridView>
                    </ListView.View>
                </ListView>
            </Grid>
        </DataTemplate>

        <DataTemplate DataType="{x:Type viewModels:MateriauxUserViewModel}">
            <Grid>
                <ListBox Style="{StaticResource ModernListBoxStyle}"
                         ItemsSource="{Binding AvailableMaterials}"
                         SelectedItem="{Binding SelectedMaterial, Mode=TwoWay}"
                         DisplayMemberPath="Name"
                         SelectionChanged="MaterialSelectionChanged"
                         Background="#FF120D0D"
                         BorderThickness="0"
                         FontSize="12"/>
            </Grid>
        </DataTemplate>
    </UserControl.Resources>

    <!-- Remplace le fond fixe par un binding sur la propriété Background du UserControl -->
    <Grid Background="{Binding Background, RelativeSource={RelativeSource AncestorType=UserControl}}">
        <!-- Message d'attente de sélection -->
        <TextBlock Text="Veuillez sélectionner une catégorie pour afficher les matériaux."
                   FontStyle="Italic"
                   Style="{StaticResource InfoTextStyle}"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"
                   Visibility="{Binding SelectedCategory, Converter={StaticResource CategoryToVisibility}, ConverterParameter=NONE}"/>

        <!-- SECTION MB -->
        <ScrollViewer HorizontalScrollBarVisibility="Auto"
                      VerticalScrollBarVisibility="Auto"
                      Visibility="{Binding SelectedCategory, Converter={StaticResource CategoryToVisibility}, ConverterParameter=MB}">
            <StackPanel>
                <Border Style="{StaticResource SectionCardStyle}"
                        Padding="16,10,16,10"
                        Margin="0,0,0,12"
                        HorizontalAlignment="Left">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,0,0,8">
                        <!-- Température -->
                        <StackPanel Orientation="Horizontal" Margin="0,0,20,0" VerticalAlignment="Bottom">
                            <TextBlock Text="Teq =" Style="{StaticResource LabelStyle}" FontSize="14" Margin="0,0,6,0" VerticalAlignment="Center"/>
                            <Button Style="{StaticResource SmallRoundedButton}" Click="OnTemperatureDown" Cursor="Hand" Focusable="True"><TextBlock Text="-" FontSize="12"/></Button>
                            <Border Style="{StaticResource ValueBoxBorderStyle}" Padding="8,1" Margin="0,0,3,0">
                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding CurrentMaterialViewModel.SelectedTemperature}" Style="{StaticResource ValueNumberTextStyle}"/>
                                    <TextBlock Text="°C" Style="{StaticResource ValueUnitTextStyle}"/>
                                </StackPanel>
                            </Border>
                            <Button Style="{StaticResource SmallRoundedButton}" Margin="0,0,0,0" Click="OnTemperatureUp" Cursor="Hand" Focusable="True"><TextBlock Text="+" FontSize="12"/></Button>
                        </StackPanel>
                        <!-- Fréquence -->
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Bottom">
                            <TextBlock Text="Fr =" Style="{StaticResource LabelStyle}" FontSize="14" Margin="0,0,6,0" VerticalAlignment="Center"/>
                            <Button Style="{StaticResource SmallRoundedButton}" Click="OnFrequenceDown" Cursor="Hand" Focusable="True"><TextBlock Text="-" FontSize="12"/></Button>
                            <Border Style="{StaticResource ValueBoxBorderStyle}" Padding="8,1" Margin="0,0,3,0">
                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                    <TextBlock Text="{Binding CurrentMaterialViewModel.SelectedFrequence}" Style="{StaticResource ValueNumberTextStyle}"/>
                                    <TextBlock Text="Hz" Style="{StaticResource ValueUnitTextStyle}"/>
                                </StackPanel>
                            </Border>
                            <Button Style="{StaticResource SmallRoundedButton}" Margin="0,0,0,0" Click="OnFrequenceUp" Cursor="Hand" Focusable="True"><TextBlock Text="+" FontSize="12"/></Button>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Liste MB -->
                <Border Style="{StaticResource SectionCardStyle}" Padding="0" Margin="0">
                    <ListView x:Name="BitumeListView"
                              Style="{StaticResource MaterialListViewStyle}"
                              ItemsSource="{Binding CurrentMaterialViewModel.AvailableMaterials}"
                              SelectedItem="{Binding CurrentMaterialViewModel.SelectedMaterial, Mode=TwoWay}"
                              SelectionChanged="MaterialSelectionChanged"
                              Margin="0"
                              MinWidth="1200"
                              FontSize="11"
                              AlternationCount="2"
                              local:GridViewVerticalGridLines.IsEnabled="True"
                              ItemContainerStyle="{StaticResource MaterialListViewItemStyle}">
                        <ListView.View>
                            <GridView>
                                <GridView.ColumnHeaderContainerStyle>
                                    <Style TargetType="GridViewColumnHeader" BasedOn="{StaticResource ColumnHeaderFlatBlack}"/>
                                </GridView.ColumnHeaderContainerStyle>

                                <GridViewColumn Header="Statut" Width="80">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock Text="{Binding Statut}" HorizontalAlignment="Center"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="Nom" Width="140">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="8,0">
                                                <TextBlock Text="{Binding Name}" TextAlignment="Center"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="E (MPa)" Width="90">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock Text="{Binding ComputedModulus, StringFormat=0.###, TargetNullValue=/}" TextAlignment="Center"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="ν" Width="50">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock Text="{Binding PoissonRatio, StringFormat=0.###, TargetNullValue=/}" TextAlignment="Center"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="E(10°C)" Width="90">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock Text="{Binding Epsi0_10C, StringFormat=0.###, TargetNullValue=/}" TextAlignment="Center"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="-1/b" Width="60">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock TextAlignment="Center" Text="{Binding InverseB, StringFormat=0.###, TargetNullValue=/}"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="SN" Width="60">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock TextAlignment="Center" Text="{Binding SN, StringFormat=0.###, TargetNullValue=/}"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="Sh" Width="60">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0" Background="Transparent" MouseLeftButtonDown="OnShCellDoubleClick">
                                                <TextBlock TextAlignment="Center" Text="{Binding ShDisplay}"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="Kc" Width="60">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock TextAlignment="Center" Text="{Binding Kc, StringFormat=0.###, TargetNullValue=/}"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="E(-10°C)" Width="90">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock TextAlignment="Center" Text="{Binding EvsTemperature[-10], StringFormat=0.###, TargetNullValue=/}"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="E(0°C)" Width="90">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock TextAlignment="Center" Text="{Binding EvsTemperature[0], StringFormat=0.###, TargetNullValue=/}"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="E(10°C)" Width="90">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock TextAlignment="Center" Text="{Binding EvsTemperature[10], StringFormat=0.###, TargetNullValue=/}"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="E(20°C)" Width="90">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock TextAlignment="Center" Text="{Binding EvsTemperature[20], StringFormat=0.###, TargetNullValue=/}"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="E(30°C)" Width="90">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock TextAlignment="Center" Text="{Binding EvsTemperature[30], StringFormat=0.###, TargetNullValue=/}"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="E(40°C)" Width="90">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock TextAlignment="Center" Text="{Binding EvsTemperature[40], StringFormat=0.###, TargetNullValue=/}"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!-- SECTION MTLH -->
        <ScrollViewer HorizontalScrollBarVisibility="Auto"
                      VerticalScrollBarVisibility="Auto"
                      Visibility="{Binding SelectedCategory, Converter={StaticResource CategoryToVisibility}, ConverterParameter=MTLH}">
            <StackPanel>
                <Border Style="{StaticResource SectionCardStyle}" Padding="0" Margin="0">
                    <ListView x:Name="MtlhListView"
                              Style="{StaticResource MaterialListViewStyle}"
                              ItemsSource="{Binding CurrentMaterialViewModel.AvailableMaterials}"
                              SelectedItem="{Binding CurrentMaterialViewModel.SelectedMaterial, Mode=TwoWay}"
                              SelectionChanged="MaterialSelectionChanged"
                              Margin="0"
                              MinWidth="820"
                              FontSize="11"
                              local:GridViewVerticalGridLines.IsEnabled="True"
                              ItemContainerStyle="{StaticResource MaterialListViewItemStyle}">
                        <ListView.View>
                            <GridView>
                                <GridView.ColumnHeaderContainerStyle>
                                    <Style TargetType="GridViewColumnHeader" BasedOn="{StaticResource ColumnHeaderFlatBlack}"/>
                                </GridView.ColumnHeaderContainerStyle>

                                <GridViewColumn Header="statut" Width="70">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock Text="{Binding Statut}" TextAlignment="Center"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>

                                <GridViewColumn Header="nom" Width="120">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="8,0">
                                                <TextBlock Text="{Binding Name}" TextAlignment="Center"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>

                                <GridViewColumn Header="E (MPa)" Width="80">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock Text="{Binding ComputedModulus, StringFormat=0.###, TargetNullValue=/}" TextAlignment="Center"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="Sigma6 (MPa)" Width="80">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock Text="{Binding Sigma6, StringFormat=0.###, TargetNullValue=/}" TextAlignment="Center"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="-1/b" Width="50">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock TextAlignment="Center" Text="{Binding InverseB, StringFormat=0.###, TargetNullValue=/}"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="SN" Width="50">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock TextAlignment="Center" Text="{Binding SN, StringFormat=0.###, TargetNullValue=/}"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="Sh" Width="60">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0" Background="Transparent" MouseLeftButtonDown="OnShCellDoubleClick">
                                                <TextBlock TextAlignment="Center" Text="{Binding ShDisplay}"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="Kc" Width="60">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock TextAlignment="Center" Text="{Binding Kc, StringFormat=0.###, TargetNullValue=/}"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="Kd" Width="60">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock TextAlignment="Center" Text="{Binding Kd, StringFormat=0.###, TargetNullValue=/}"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!-- SECTION BETON -->
        <ScrollViewer HorizontalScrollBarVisibility="Auto"
                      VerticalScrollBarVisibility="Auto"
                      Visibility="{Binding SelectedCategory, Converter={StaticResource CategoryToVisibility}, ConverterParameter=Beton}">
            <StackPanel>
                <Border Style="{StaticResource SectionCardStyle}" Padding="0" Margin="0">
                    <ListView x:Name="BetonListView"
                              Style="{StaticResource MaterialListViewStyle}"
                              ItemsSource="{Binding CurrentMaterialViewModel.AvailableMaterials}"
                              SelectedItem="{Binding CurrentMaterialViewModel.SelectedMaterial, Mode=TwoWay}"
                              SelectionChanged="MaterialSelectionChanged"
                              Margin="0"
                              MinWidth="900"
                              FontSize="11"
                              local:GridViewVerticalGridLines.IsEnabled="True"
                              ItemContainerStyle="{StaticResource MaterialListViewItemStyle}">
                        <ListView.View>
                            <GridView>
                                <GridView.ColumnHeaderContainerStyle>
                                    <Style TargetType="GridViewColumnHeader" BasedOn="{StaticResource ColumnHeaderFlatBlack}"/>
                                </GridView.ColumnHeaderContainerStyle>

                                <GridViewColumn Header="statut" Width="80">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock Text="{Binding Statut}" HorizontalAlignment="Center"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>

                                <GridViewColumn Header="nom" Width="140">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="8,0">
                                                <TextBlock Text="{Binding Name}" TextAlignment="Center"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>

                                <GridViewColumn Header="E (MPa)" Width="100">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock Text="{Binding ComputedModulus, StringFormat=0.###, TargetNullValue=/}" TextAlignment="Center"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="ν" Width="60">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock Text="{Binding PoissonRatio, StringFormat=0.###, TargetNullValue=/}" TextAlignment="Center"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="Sigma6 (MPa)" Width="100">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock Text="{Binding Sigma6, StringFormat=0.###, TargetNullValue=/}" TextAlignment="Center"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="-1/b" Width="60">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock TextAlignment="Center" Text="{Binding InverseB, StringFormat=0.###, TargetNullValue=/}"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="SN" Width="60">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock TextAlignment="Center" Text="{Binding SN, StringFormat=0.###, TargetNullValue=/}"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="Kc" Width="60">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock TextAlignment="Center" Text="{Binding Kc, StringFormat=0.###, TargetNullValue=/}"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!-- SECTION SOL & GNT -->
        <ScrollViewer HorizontalScrollBarVisibility="Auto"
                      VerticalScrollBarVisibility="Auto"
                      Visibility="{Binding SelectedCategory, Converter={StaticResource CategoryToVisibility}, ConverterParameter=Sol_GNT}">
            <StackPanel>
                <Border Style="{StaticResource SectionCardStyle}" Padding="0" Margin="0">
                    <ListView x:Name="SolGntListView"
                              Style="{StaticResource MaterialListViewStyle}"
                              ItemsSource="{Binding CurrentMaterialViewModel.AvailableMaterials}"
                              SelectedItem="{Binding CurrentMaterialViewModel.SelectedMaterial, Mode=TwoWay}"
                              SelectionChanged="MaterialSelectionChanged"
                              Margin="0"
                              MinWidth="900"
                              FontSize="11"
                              local:GridViewVerticalGridLines.IsEnabled="True"
                              ItemContainerStyle="{StaticResource MaterialListViewItemStyle}">
                        <ListView.View>
                            <GridView>
                                <GridView.ColumnHeaderContainerStyle>
                                    <Style TargetType="GridViewColumnHeader" BasedOn="{StaticResource ColumnHeaderFlatBlack}"/>
                                </GridView.ColumnHeaderContainerStyle>
                                <GridViewColumn Header="statut" Width="70">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock Text="{Binding Statut}" TextAlignment="Center"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="nom" Width="120">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="8,0">
                                                <TextBlock Text="{Binding Name}" TextAlignment="Center"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="E (MPa)" Width="80">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock Text="{Binding ComputedModulus, StringFormat=0.###, TargetNullValue=/}" TextAlignment="Center"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="Sigma6 (MPa)" Width="80">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock Text="{Binding Sigma6, StringFormat=0.###, TargetNullValue=/}" TextAlignment="Center"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="A faible trafic" Width="120">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock Text="{Binding AdditionalProperties[A_faible], StringFormat=0.###, TargetNullValue=/}" TextAlignment="Center"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="A fort trafic" Width="120">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock Text="{Binding AdditionalProperties[A_fort], StringFormat=0.###, TargetNullValue=/}" TextAlignment="Center"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                                <GridViewColumn Header="pente b" Width="100">
                                    <GridViewColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Padding="6,0">
                                                <TextBlock Text="{Binding AdditionalProperties[pente_b], StringFormat=0.###, TargetNullValue=/}" TextAlignment="Center"/>
                                            </Border>
                                        </DataTemplate>
                                    </GridViewColumn.CellTemplate>
                                </GridViewColumn>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </Border>
            </StackPanel>
        </ScrollViewer>
    </Grid>
</UserControl>
